<template>
    <svg :x="position.x - 40"
         :y="position.y - 185"
         width="80"
         height="200"
         viewBox="0 0 357 756"
         fill="none"
         xmlns="http://www.w3.org/2000/svg"
         @mouseover="highlighted = true"
         @mouseout="highlighted = false"
         @click="$emit('CLICK', knight)">
        <path d="M93.5001 350.5C109.231 340.858 118.5 350.5 118.5 350.5L106.171 440.616L84.8585 472.077L61.516 458.884C61.516 458.884 82.3212 427.422 80.7989 410.676C79.2766 393.931 77.7693 360.141 93.5001 350.5Z"
              fill="#956947"/>
        <path d="M34.6216 477.151C36.1439 474.107 56.4417 463.958 63.5459 459.391C70.6502 454.824 83.3363 471.062 83.3363 471.062C80.7991 482.902 75.4202 507.598 74.2023 511.658C72.9844 515.717 69.297 513.349 67.6055 511.658L70.6502 489.33C68.2821 496.773 64.8652 508.41 62.0235 511.658C59.1818 514.905 57.6257 509.29 56.9491 506.583L67.6055 484.256L49.3375 506.583L44.263 503.031L59.9938 478.166L44.263 496.942L41.7258 492.375L54.4119 474.107C54.4119 474.107 41.2183 483.241 38.1736 482.733C35.1289 482.226 33.0993 480.196 34.6216 477.151Z"
              fill="#E2B281"/>
        <path d="M14 96.5885C14 96.5885 22.9048 100.223 29.921 95L79 706.56L74.859 706.56L14 96.5885Z"
              fill="#7D4518"/>
        <path d="M94.5 111C54 93 26 119 26 119C28 139.667 32 181.5 32 183.5C32 185.5 61 157.5 100.5 174C140 190.5 203 174 203 174L159 146.5L191 111C191 111 135 129 94.5 111Z"
              :fill="color" :stroke="$util.shadeColor(color, 0.5)"
              stroke-width="5"/>
        <path d="M36.8028 84.075L30.7606 95.6148C30.7606 95.6148 29.1127 98.3623 22.5211 98.9118C15.9296 99.4613 13.7324 97.2633 13.7324 97.2633L4.94366 87.9216L0 71.4363L11.5352 78.0304V0L29.1127 78.0304L39 68.1392L36.8028 84.075Z"
              fill="#6A7577"/>
        <path d="M36.8028 84.075L30.7606 95.6148C30.7606 95.6148 29.1127 98.3623 22.5211 98.9118C15.9296 99.4613 13.7324 97.2633 13.7324 97.2633L4.94366 87.9216L0 71.4363L11.5352 78.0304V0L29.1127 78.0304L39 68.1392L36.8028 84.075Z"
              fill="url(#paint0_linear)"/>
        <path d="M34.8518 477.828C36.3741 474.783 56.6719 464.634 63.7762 460.067C70.8804 455.5 83.5665 471.739 83.5665 471.739L54.6422 474.783C54.6422 474.783 41.4485 483.917 38.4038 483.41C35.3592 482.902 33.3295 480.873 34.8518 477.828Z"
              fill="#E2B281"/>
        <path d="M132.846 696.788C132.846 696.788 94.7877 732.309 74.9974 722.668C55.207 713.026 94.7877 690.699 94.7877 690.699L99.3547 678.52H132.846V696.788Z"
              fill="#412F20" stroke="black"/>
        <path d="M96.8509 673.616C104.162 662.397 96.8509 534.493 96.8509 534.493L144.654 586.664C141.467 617.705 129.47 669.689 135.094 683.714C140.718 697.739 89.5398 684.836 96.8509 673.616Z"
              fill="#674D38" stroke="black"/>
        <path d="M249.535 669.078C249.535 669.078 238.393 719.198 216.5 721.5C194.607 723.801 216.5 681.5 216.5 681.5L216.5 669.078L239.861 653.582L249.535 669.078Z"
              fill="#412F20" stroke="black"/>
        <line x1="212" y1="698.5" x2="222" y2="698.5" stroke="#797979"/>
        <line x1="216" y1="691.5" x2="226" y2="691.5" stroke="#797979"/>
        <line x1="219" y1="682.5" x2="229" y2="682.5" stroke="#797979"/>
        <line y1="-0.5" x2="6.48131" y2="-0.5"
              transform="matrix(0.905465 0.424421 -0.605278 0.796014 83 705.897)"
              stroke="#797979"/>
        <line y1="-0.5" x2="6.48131" y2="-0.5"
              transform="matrix(0.905465 0.424421 -0.605278 0.796014 89.9021 701.008)"
              stroke="#797979"/>
        <line y1="-0.5" x2="6.48131" y2="-0.5"
              transform="matrix(0.905465 0.424421 -0.605278 0.796014 97.6189 694)"
              stroke="#797979"/>
        <path d="M242.888 658.266C239.297 668.443 216.5 675.5 216.5 675.5C216.5 675.5 198.555 647.37 178.5 628C153.485 603.839 122.364 592.644 122.364 592.644L165.65 534.54C165.65 534.54 176.829 563.333 199.084 597.656C214.823 621.929 244.375 654.05 242.888 658.266Z"
              fill="#674D38" stroke="black"/>
        <path d="M211.72 478.167L207.153 532.971V552.761L99.5742 508.613C99.5742 508.613 91.9625 421.84 91.9625 395.453C91.9625 369.066 98.0001 346.5 108.5 345.5C119 344.5 135.5 345.5 167.572 359.932C199.643 374.364 236.077 395.453 236.077 395.453L227.958 414.229L211.72 478.167Z"
              fill="#9F9F9F"/>
        <path d="M270.075 528.91C245.211 472.584 263.986 426.914 250.793 409.661C237.599 392.408 240.136 401.541 234.554 395.452C228.972 389.363 225.42 395.452 225.42 395.452V494.404L138.647 555.805C138.647 555.805 195.988 573.565 210.704 585.237C225.42 596.908 217.301 613.146 234.554 617.713C251.807 622.28 263.986 612.639 274.642 617.713C285.299 622.788 299 643.085 299 643.085C299 643.085 294.94 585.237 270.075 528.91Z"
              :fill="color"/>
        <path d="M270.075 528.91C245.211 472.584 263.986 426.914 250.793 409.661C237.599 392.408 240.136 401.541 234.554 395.452C228.972 389.363 225.42 395.452 225.42 395.452V494.404L138.647 555.805C138.647 555.805 195.988 573.565 210.704 585.237C225.42 596.908 217.301 613.146 234.554 617.713C251.807 622.28 263.986 612.639 274.642 617.713C285.299 622.788 299 643.085 299 643.085C299 643.085 294.94 585.237 270.075 528.91Z"
              fill="url(#paint1_linear)" fill-opacity="0.3"/>
        <path d="M207.66 410.169C171.124 422.855 171.124 405.095 171.124 405.095C171.124 405.095 193.451 391.394 200.556 384.797C207.66 378.2 191 371 191 371C191 371 221.361 377.185 229.48 384.797C236.135 391.035 248.243 405.455 252.395 410.455C253.355 411.498 253.837 412.199 253.837 412.199C253.837 412.199 253.309 411.555 252.395 410.455C247.876 405.539 232.774 393.008 207.66 410.169Z"
              :fill="color"/>
        <path d="M201.063 466.495C207.153 491.868 216.287 542.612 216.287 542.612C216.287 542.612 235.062 526.374 236.585 511.658C238.107 496.942 241.151 470.048 241.151 470.048C241.151 470.048 248.256 453.302 244.704 427.422C241.151 401.542 226.943 405.095 226.943 405.095C226.943 405.095 219.839 405.095 211.72 412.706C203.601 420.318 201.063 427.422 201.063 427.422C201.063 427.422 194.974 441.123 201.063 466.495Z"
              fill="#956A47"/>
        <path d="M137.361 512.933L167.498 537.374L175.844 527.083L145.708 502.641C145.708 502.641 136.216 503.474 137.361 512.933Z"
              fill="#90471F"/>
        <path d="M320.063 635.518L192.426 532.001L175.734 552.583L303.37 656.1L336.534 665.938L320.063 635.518Z"
              fill="#C4C4C4"/>
        <rect x="309.214" y="641.648" width="3.31257" height="164.337"
              rx="1.65629" transform="rotate(129.043 309.214 641.648)"
              fill="#A0A0A0"/>
        <path d="M165.301 565.448L175.734 552.584L192.427 532.002L202.86 519.138C200.671 510.966 192.223 510.512 192.223 510.512C192.223 510.512 185.65 522.241 181.79 523.376C177.931 524.511 175.844 527.083 175.844 527.083L167.498 537.375C167.498 537.375 165.411 539.947 165.097 543.958C164.783 547.968 154.664 556.822 154.664 556.822C154.664 556.822 156.853 564.994 165.301 565.448Z"
              fill="#515151"/>
        <path d="M252.29 455.868L253.788 455.948L253.893 453.977L251.967 454.403L251.966 454.404L251.966 454.404L251.961 454.405L251.936 454.41C251.914 454.415 251.879 454.422 251.831 454.432C251.736 454.452 251.591 454.482 251.399 454.52C251.014 454.595 250.44 454.703 249.692 454.829C248.196 455.082 246.004 455.411 243.241 455.709C237.715 456.305 229.917 456.775 220.848 456.273C202.697 455.268 179.556 450.372 159.325 434.887L158.266 434.076L157.337 435.033C140.869 452 120.251 459.766 103.678 463.281C95.3991 465.037 88.1546 465.727 82.9848 465.978C80.4007 466.103 78.3373 466.118 76.9251 466.103C76.2191 466.095 75.676 466.08 75.3122 466.066C75.1303 466.059 74.9933 466.053 74.9031 466.049C74.858 466.047 74.8247 466.045 74.8033 466.044L74.7802 466.042L74.7755 466.042L74.7753 466.042L74.7748 466.042L72.8462 465.925L73.2116 467.823L74.6846 467.539C73.2116 467.823 73.2118 467.824 73.2121 467.825L73.2134 467.832L73.2183 467.857L73.2374 467.955C73.2542 468.042 73.2794 468.17 73.3129 468.338C73.3799 468.675 73.4801 469.174 73.6134 469.823C73.8801 471.122 74.2795 473.024 74.8113 475.443C75.8749 480.279 77.4686 487.18 79.5906 495.449C83.8332 511.983 90.193 534.006 98.6575 555.931C107.115 577.837 117.708 599.738 130.45 615.966C143.167 632.163 158.269 643.003 175.746 642.076C193.243 641.148 206.771 628.624 217.189 610.981C227.625 593.306 235.152 570.158 240.557 547.235C245.966 524.292 249.273 501.474 251.227 484.4C252.205 475.861 252.845 468.753 253.24 463.778C253.438 461.29 253.575 459.336 253.662 458.002C253.706 457.334 253.737 456.822 253.758 456.476C253.768 456.304 253.776 456.172 253.781 456.084L253.786 455.983L253.788 455.957L253.788 455.95C253.788 455.949 253.788 455.948 252.29 455.868Z"
              fill="#B06326" stroke="#7D4518" stroke-width="3"/>
        <path d="M162.685 450.81L161.624 449.995L160.693 450.957C147.017 465.093 129.888 471.568 116.108 474.501C109.225 475.965 103.202 476.541 98.9043 476.75C96.7564 476.854 95.0421 476.867 93.8699 476.854C93.2838 476.848 92.8335 476.835 92.5324 476.823C92.3819 476.818 92.2687 476.813 92.1946 476.809L92.1129 476.805L92.0944 476.804L92.091 476.804L92.0908 476.804L92.0905 476.804H92.0904L90.1628 476.686L90.5269 478.584L92 478.301C90.5269 478.584 90.527 478.584 90.5273 478.586L90.5284 478.591L90.5325 478.613L90.5485 478.695C90.5626 478.767 90.5836 478.875 90.6116 479.016C90.6675 479.298 90.751 479.715 90.8623 480.259C91.0847 481.346 91.4177 482.937 91.8612 484.96C92.748 489.005 94.0767 494.777 95.8457 501.693C99.3825 515.52 104.685 533.94 111.743 552.281C118.794 570.602 127.631 588.937 138.271 602.531C148.887 616.094 161.541 625.235 176.228 624.454C190.937 623.671 202.27 613.111 210.966 598.337C219.681 583.53 225.96 564.151 230.466 544.98C234.977 525.787 237.734 506.702 239.363 492.423C240.178 485.282 240.711 479.337 241.041 475.176C241.206 473.095 241.32 471.46 241.393 470.343C241.429 469.785 241.456 469.357 241.473 469.067C241.481 468.922 241.487 468.812 241.492 468.738L241.496 468.653L241.497 468.632L241.498 468.626C241.498 468.624 241.498 468.624 240 468.544L241.498 468.624L241.602 466.652L239.676 467.08L239.675 467.08L239.671 467.081L239.652 467.085C239.633 467.089 239.604 467.095 239.565 467.103C239.487 467.12 239.367 467.144 239.208 467.175C238.89 467.238 238.414 467.328 237.792 467.433C236.55 467.644 234.728 467.918 232.432 468.166C227.838 468.663 221.354 469.056 213.813 468.637C198.718 467.799 179.49 463.715 162.685 450.81Z"
              fill="#8A5124" stroke="#7D4518" stroke-width="3"/>
        <path d="M138.878 393.608C129.386 389.735 126.349 380.053 126.349 380.053L122.173 371.339L119.136 335.03L127.868 307.435C146.344 313.89 183.829 326.993 185.955 327.768C188.613 328.736 184.437 366.497 183.298 371.339C182.387 375.212 148.369 397.481 138.878 393.608Z"
              fill="#E2B281"/>
        <path d="M148.37 376.18L129.007 367.466C129.007 367.466 130.926 371.111 137 374.5C143.075 377.889 148.37 376.18 148.37 376.18Z"
              fill="white" fill-opacity="0.27" stroke="#AB3737"/>
        <ellipse rx="5.79579" ry="2.39383"
                 transform="matrix(0.954104 0.299475 -0.189539 0.981873 131.984 345.086)"
                 fill="#3A3A3A"/>
        <ellipse rx="5.79579" ry="2.39383"
                 transform="matrix(0.954104 0.299475 -0.189539 0.981873 152.984 354.086)"
                 fill="#3A3A3A"/>
        <path d="M139.58 354.651L135.784 362.397L141.916 365.045"
              stroke="black"/>
        <path d="M122.553 252.225L135.841 288.26C135.841 288.26 149.889 276.999 177.603 280.152C205.318 283.305 206.078 336.907 206.078 336.907L229.996 340.511L223.162 336.907L236.071 329.25L225.061 321.142H233.793L228.857 313.935L233.793 311.683L227.339 304.476L233.793 301.773L228.857 296.818L233.793 293.215L229.996 286.008H236.071L228.857 275.197H233.793L228.857 268.44L233.793 266.639L227.339 263.486L229.996 257.63H225.061L227.339 252.225H219.745V241.414C217.341 242.915 212.152 245.918 210.634 245.918C209.115 245.918 213.797 241.414 216.328 239.162L206.078 241.414L210.634 236.009H198.864L202.661 232.856L190.891 236.009V230.153L184.058 236.009V230.153L177.603 236.009L175.705 227L170.01 232.856L166.214 230.153L163.177 236.009L160.139 232.856L155.583 241.414L152.166 236.009L148.37 245.918L141.156 239.162V245.918L135.841 241.414C135.208 242.915 133.791 246.459 133.184 248.621C132.576 250.783 129.387 247.72 127.868 245.918V252.225H122.553Z"
              :fill="color" :stroke="$util.shadeColor(color, 0.5)"
              stroke-width="2"/>
        <path d="M174.186 344.564C174.186 393.212 143.434 385.554 143.434 385.554C143.434 385.554 137.739 397.266 151.407 400.419C165.075 403.572 191.271 389.608 198.864 372.942C206.457 356.276 208.356 329.7 201.522 300.421C182.159 260.332 147.231 271.593 126.35 297.268C115.34 332.403 111.163 372.942 130.146 385.554C130.146 385.554 124.451 378.798 122.173 361.681C119.895 344.564 126.35 326.547 126.35 326.547C126.35 326.547 147.99 344.564 174.186 344.564Z"
              fill="#797979"/>
        <defs>
            <linearGradient id="paint0_linear" x1="19.5" y1="0" x2="19.5"
                            y2="99" gradientUnits="userSpaceOnUse">
                <stop stop-color="#303030"/>
                <stop offset="1" stop-color="white" stop-opacity="0"/>
            </linearGradient>
            <linearGradient id="paint1_linear" x1="218.824" y1="396.129"
                            x2="218.824" y2="643.085"
                            gradientUnits="userSpaceOnUse">
                <stop/>
                <stop offset="1" stop-opacity="0"/>
            </linearGradient>
        </defs>

        <g v-if="countDown">
            <text x="160" y="510" class="count-down" fill="white"
                  text-anchor="middle">Moves:
            </text>
            <text x="162" y="543"
                  class="count-down" fill="white"
                  text-anchor="middle">{{ countDown }}
            </text>
        </g>
        <g v-else>
            <text x="160" y="510" class="count-down"
                  fill="rgba(255,255,255,0.8)"
                  text-anchor="middle">{{ knight.name.split(" ")[0].substring(0,8) }}
            </text>
            <text v-if="knight.name.split(' ')[1]" x="162" y="543"
                  class="count-down" fill="rgba(255,255,255,0.8)"
                  text-anchor="middle">{{ knight.name.split(' ')[1].substring(0,7) }}
            </text>
        </g>
    </svg>
</template>

<script>

    export default {
        name: "Knight",
        props: {
            position: Object,
            color: String,
            knight: Object,
            isActive: Boolean,
            viewPosition: Object
        },
        data() {
            return {
                highlighted: false,
                countDown: undefined,
                intervalId: undefined
            };
        },
        created() {
            this.intervalId = setInterval(() => {
                if (!this.knight.arrivesAt) return;
                let seconds = Math.max(0, Math.floor((this.knight.arrivesAt - Date.now()) / 1000));
                const minutes = Math.floor(seconds / 60) || 0;
                seconds = seconds % 60;
                this.countDown = `${minutes < 10 ? ('0' + minutes) : minutes}:${seconds < 10 ? ('0' + seconds) : seconds}`;
            }, 1000);
        },
        beforeDestroy() {
            if (this.intervalId) clearInterval(this.intervalId);
        }
    };
</script>

<style lang="scss" scoped>
    @keyframes rotate_sword {
        0% {
            transform: rotate(0deg);
        }

        25% {
            transform: rotate(10deg);
        }

        75% {
            transform: rotate(-10deg);
        }

        100% {
            transform: rotate(0deg);
        }
    }

    .sword {
        animation: rotate_sword;
        animation-duration: 2s;
        animation-iteration-count: infinite;
        animation-timing-function: linear;
        transform-origin: 50% 50%;
    }

    .count-down {
        font: 30px 'MedievalSharp';
        font-weight: bold;
        -webkit-touch-callout: none; /* iOS Safari */
        -webkit-user-select: none; /* Safari */
        -khtml-user-select: none; /* Konqueror HTML */
        -moz-user-select: none; /* Old versions of Firefox */
        -ms-user-select: none; /* Internet Explorer/Edge */
        user-select: none;
        transform: rotate(-3deg);
        transform-origin: 50% 50%;
        width: 50px;
    }
</style>
